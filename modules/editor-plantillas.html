<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BS Dash - Editor de Plantillas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="../css/styles.css">
    <style>
        .template-preview {
    border: 2px dashed #d1d5db;
    min-height: 400px;
    background: white;
    font-family: Arial, sans-serif !important;
    line-height: 1.6 !important;
    color: #333 !important;
}
.variable-item {
    cursor: grab;
    transition: all 0.2s;
}
.variable-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}
.editor-toolbar {
    background: #f8fafc;
    border-bottom: 1px solid #e2e8f0;
}
.template-active {
    border-color: #3b82f6;
    background: #eff6ff;
}

/* ESTILOS CRÍTICOS PARA EL EDITOR */
#editorArea {
    font-family: Arial, sans-serif !important;
    line-height: 1.6 !important;
    color: #333 !important;
}

#editorArea * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

#editorArea h1, #editorArea h2, #editorArea h3 {
    margin-bottom: 10px !important;
    font-weight: bold !important;
}

#editorArea p {
    margin-bottom: 8px !important;
}

#editorArea div {
    display: block !important;
}

/* Asegurar que el contenido editable se vea bien */
#editorArea[contenteditable="true"]:focus {
    outline: 2px solid #3b82f6;
    outline-offset: 2px;
}

/* Forzar estilos en el contenido editable */
#editorArea [style*="color"] {
    color: inherit !important;
}

#editorArea [style*="font-size"] {
    font-size: inherit !important;
}
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bs-card mx-4 mt-4 mb-6">
        <div class="flex items-center justify-between p-4">
            <div class="flex items-center gap-3">
                <a href="../dashboard.html" class="w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center border border-blue-200">
                    <i class="bi bi-arrow-left text-blue-600"></i>
                </a>
                <div>
                    <h1 class="text-xl font-bold text-gray-800">Editor de Plantillas</h1>
                    <p class="text-sm text-gray-600">Diseña y personaliza tus documentos</p>
                </div>
            </div>
            
            <div class="flex items-center gap-3">
                <button id="btnPreview" class="bs-btn bg-green-50 text-green-600 border-green-200">
                    <i class="bi bi-eye"></i> Vista Previa
                </button>
                <button id="btnSave" class="bs-btn bs-btn-primary">
                    <i class="bi bi-save"></i> Guardar Plantilla
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4">
        <div class="grid grid-cols-1 xl:grid-cols-4 gap-6">
            <!-- Sidebar - Plantillas y Variables -->
            <div class="xl:col-span-1 space-y-6">
                <!-- Selector de Plantillas -->
                <div class="bs-card p-4">
                    <h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
                        <i class="bi bi-file-earmark"></i>
                        Plantillas
                    </h3>
                    <div class="space-y-2">
                        <button class="template-btn w-full text-left p-3 rounded-lg border hover:border-blue-300 template-active" data-template="factura">
                            <div class="font-medium text-gray-800">Factura</div>
                            <div class="text-xs text-gray-500">Plantilla de facturación</div>
                        </button>
                        <button class="template-btn w-full text-left p-3 rounded-lg border hover:border-blue-300" data-template="cotizacion">
                            <div class="font-medium text-gray-800">Cotización</div>
                            <div class="text-xs text-gray-500">Presupuestos y cotizaciones</div>
                        </button>
                        <button class="template-btn w-full text-left p-3 rounded-lg border hover:border-blue-300" data-template="recibo">
                            <div class="font-medium text-gray-800">Recibo</div>
                            <div class="text-xs text-gray-500">Recibos de pago</div>
                        </button>
                        <button class="template-btn w-full text-left p-3 rounded-lg border hover:border-blue-300" data-template="orden">
                            <div class="font-medium text-gray-800">Orden de Trabajo</div>
                            <div class="text-xs text-gray-500">Órdenes de servicio</div>
                        </button>
                    </div>
                </div>

                <!-- Variables Disponibles -->
                <div class="bs-card p-4">
                    <h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
                        <i class="bi bi-tags"></i>
                        Variables Disponibles
                    </h3>
                    <div class="space-y-2">
                        <!-- Información de la Empresa -->
                        <div class="variable-group">
                            <h4 class="text-sm font-medium text-gray-700 mb-2">Información Empresa</h4>
                            <div class="grid grid-cols-1 gap-1">
                                <div class="variable-item p-2 bg-blue-50 rounded border border-blue-200 text-sm" data-variable="{{empresa_nombre}}">
                                    <i class="bi bi-building text-blue-600 mr-2"></i>Nombre Empresa
                                </div>
                                <div class="variable-item p-2 bg-blue-50 rounded border border-blue-200 text-sm" data-variable="{{empresa_rif}}">
                                    <i class="bi bi-card-text text-blue-600 mr-2"></i>RIF/Empresa
                                </div>
                                <div class="variable-item p-2 bg-blue-50 rounded border border-blue-200 text-sm" data-variable="{{empresa_direccion}}">
                                    <i class="bi bi-geo-alt text-blue-600 mr-2"></i>Dirección Empresa
                                </div>
                                <div class="variable-item p-2 bg-blue-50 rounded border border-blue-200 text-sm" data-variable="{{empresa_telefono}}">
                                    <i class="bi bi-telephone text-blue-600 mr-2"></i>Teléfono Empresa
                                </div>
                            </div>
                        </div>

                        <!-- Información del Cliente -->
                        <div class="variable-group mt-3">
                            <h4 class="text-sm font-medium text-gray-700 mb-2">Información Cliente</h4>
                            <div class="grid grid-cols-1 gap-1">
                                <div class="variable-item p-2 bg-green-50 rounded border border-green-200 text-sm" data-variable="{{cliente_nombre}}">
                                    <i class="bi bi-person text-green-600 mr-2"></i>Nombre Cliente
                                </div>
                                <div class="variable-item p-2 bg-green-50 rounded border border-green-200 text-sm" data-variable="{{cliente_cedula}}">
                                    <i class="bi bi-person-badge text-green-600 mr-2"></i>Cédula/RIF Cliente
                                </div>
                                <div class="variable-item p-2 bg-green-50 rounded border border-green-200 text-sm" data-variable="{{cliente_direccion}}">
                                    <i class="bi bi-geo-alt text-green-600 mr-2"></i>Dirección Cliente
                                </div>
                                <div class="variable-item p-2 bg-green-50 rounded border border-green-200 text-sm" data-variable="{{cliente_telefono}}">
                                    <i class="bi bi-telephone text-green-600 mr-2"></i>Teléfono Cliente
                                </div>
                            </div>
                        </div>

                        <!-- Información del Documento -->
                        <div class="variable-group mt-3">
                            <h4 class="text-sm font-medium text-gray-700 mb-2">Documento</h4>
                            <div class="grid grid-cols-1 gap-1">
                                <div class="variable-item p-2 bg-purple-50 rounded border border-purple-200 text-sm" data-variable="{{documento_numero}}">
                                    <i class="bi bi-hash text-purple-600 mr-2"></i>Número Documento
                                </div>
                                <div class="variable-item p-2 bg-purple-50 rounded border border-purple-200 text-sm" data-variable="{{documento_fecha}}">
                                    <i class="bi bi-calendar text-purple-600 mr-2"></i>Fecha Emisión
                                </div>
                                <div class="variable-item p-2 bg-purple-50 rounded border border-purple-200 text-sm" data-variable="{{documento_vencimiento}}">
                                    <i class="bi bi-calendar-check text-purple-600 mr-2"></i>Fecha Vencimiento
                                </div>
                            </div>
                        </div>

                        <!-- Totales y Pagos -->
                        <div class="variable-group mt-3">
                            <h4 class="text-sm font-medium text-gray-700 mb-2">Totales y Pagos</h4>
                            <div class="grid grid-cols-1 gap-1">
                                <div class="variable-item p-2 bg-orange-50 rounded border border-orange-200 text-sm" data-variable="{{subtotal}}">
                                    <i class="bi bi-calculator text-orange-600 mr-2"></i>Subtotal
                                </div>
                                <div class="variable-item p-2 bg-orange-50 rounded border border-orange-200 text-sm" data-variable="{{descuento}}">
                                    <i class="bi bi-percent text-orange-600 mr-2"></i>Descuento
                                </div>
                                <div class="variable-item p-2 bg-orange-50 rounded border border-orange-200 text-sm" data-variable="{{iva}}">
                                    <i class="bi bi-percent text-orange-600 mr-2"></i>IVA
                                </div>
                                <div class="variable-item p-2 bg-orange-50 rounded border border-orange-200 text-sm" data-variable="{{total}}">
                                    <i class="bi bi-currency-dollar text-orange-600 mr-2"></i>Total
                                </div>
                                <div class="variable-item p-2 bg-orange-50 rounded border border-orange-200 text-sm" data-variable="{{forma_pago}}">
                                    <i class="bi bi-credit-card text-orange-600 mr-2"></i>Forma de Pago
                                </div>
                            </div>
                        </div>

                        <!-- Productos/Servicios -->
                        <div class="variable-group mt-3">
                            <h4 class="text-sm font-medium text-gray-700 mb-2">Productos</h4>
                            <div class="grid grid-cols-1 gap-1">
                                <div class="variable-item p-2 bg-red-50 rounded border border-red-200 text-sm" data-variable="{{productos_tabla}}">
                                    <i class="bi bi-table text-red-600 mr-2"></i>Tabla de Productos
                                </div>
                                <div class="variable-item p-2 bg-red-50 rounded border border-red-200 text-sm" data-variable="{{productos_detalle}}">
                                    <i class="bi bi-list-check text-red-600 mr-2"></i>Detalle Productos
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Área Principal - Editor -->
            <div class="xl:col-span-3">
                <div class="bs-card p-6">
                    <!-- Toolbar del Editor -->
                    <div class="editor-toolbar flex flex-wrap gap-2 p-4 rounded-lg mb-6">
                        <select id="fontFamily" class="bs-btn bg-white border">
                            <option value="Arial">Arial</option>
                            <option value="Helvetica">Helvetica</option>
                            <option value="Times New Roman">Times New Roman</option>
                            <option value="Georgia">Georgia</option>
                        </select>
                        
                        <select id="fontSize" class="bs-btn bg-white border">
                            <option value="12">12px</option>
                            <option value="14" selected>14px</option>
                            <option value="16">16px</option>
                            <option value="18">18px</option>
                            <option value="20">20px</option>
                        </select>
                        
                        <button class="bs-btn bg-white border" data-command="bold">
                            <i class="bi bi-type-bold"></i>
                        </button>
                        <button class="bs-btn bg-white border" data-command="italic">
                            <i class="bi bi-type-italic"></i>
                        </button>
                        <button class="bs-btn bg-white border" data-command="underline">
                            <i class="bi bi-type-underline"></i>
                        </button>
                        
                        <select id="textAlign" class="bs-btn bg-white border">
                            <option value="left">↔ Izquierda</option>
                            <option value="center">↔ Centro</option>
                            <option value="right">↔ Derecha</option>
                            <option value="justify">↔ Justificar</option>
                        </select>
                        
                        <input type="color" id="textColor" class="w-10 h-10 border rounded">
                    </div>

                    <!-- Área de Edición -->
                    <div class="template-preview p-8 rounded-lg" id="editorArea" contenteditable="true">
                        <!-- Plantilla de Factura por defecto -->
                        <div style="max-width: 800px; margin: 0 auto; font-family: Arial, sans-serif;">
                            <!-- Header -->
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 30px; border-bottom: 2px solid #3b82f6; padding-bottom: 20px;">
                                <div>
                                    <h1 style="color: #3b82f6; font-size: 28px; margin: 0; font-weight: bold;">FACTURA</h1>
                                    <p style="margin: 5px 0; color: #666;">{{empresa_nombre}}</p>
                                    <p style="margin: 5px 0; color: #666;">RIF: {{empresa_rif}}</p>
                                    <p style="margin: 5px 0; color: #666;">{{empresa_direccion}}</p>
                                    <p style="margin: 5px 0; color: #666;">Tel: {{empresa_telefono}}</p>
                                </div>
                                <div style="text-align: right;">
                                    <p style="margin: 5px 0;"><strong>N°:</strong> {{documento_numero}}</p>
                                    <p style="margin: 5px 0;"><strong>Fecha:</strong> {{documento_fecha}}</p>
                                    <p style="margin: 5px 0;"><strong>Vence:</strong> {{documento_vencimiento}}</p>
                                </div>
                            </div>

                            <!-- Información del Cliente -->
                            <div style="margin-bottom: 30px;">
                                <h2 style="color: #3b82f6; font-size: 18px; margin-bottom: 10px;">INFORMACIÓN DEL CLIENTE</h2>
                                <div style="background: #f8fafc; padding: 15px; border-radius: 8px;">
                                    <p style="margin: 5px 0;"><strong>Cliente:</strong> {{cliente_nombre}}</p>
                                    <p style="margin: 5px 0;"><strong>Cédula/RIF:</strong> {{cliente_cedula}}</p>
                                    <p style="margin: 5px 0;"><strong>Dirección:</strong> {{cliente_direccion}}</p>
                                    <p style="margin: 5px 0;"><strong>Teléfono:</strong> {{cliente_telefono}}</p>
                                </div>
                            </div>

                            <!-- Tabla de Productos -->
                            <div style="margin-bottom: 30px;">
                                <h2 style="color: #3b82f6; font-size: 18px; margin-bottom: 10px;">DETALLE DE PRODUCTOS/SERVICIOS</h2>
                                {{productos_tabla}}
                            </div>

                            <!-- Totales -->
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                                <div>
                                    <h2 style="color: #3b82f6; font-size: 18px; margin-bottom: 10px;">INFORMACIÓN DE PAGO</h2>
                                    <div style="background: #f8fafc; padding: 15px; border-radius: 8px;">
                                        <p style="margin: 5px 0;"><strong>Forma de Pago:</strong> {{forma_pago}}</p>
                                        <p style="margin: 5px 0;"><strong>Banco:</strong> {{banco}}</p>
                                        <p style="margin: 5px 0;"><strong>Referencia:</strong> {{referencia_pago}}</p>
                                    </div>
                                </div>
                                <div>
                                    <h2 style="color: #3b82f6; font-size: 18px; margin-bottom: 10px;">TOTALES</h2>
                                    <div style="background: #f8fafc; padding: 15px; border-radius: 8px;">
                                        <div style="display: flex; justify-content: space-between; margin: 8px 0;">
                                            <span>Subtotal:</span>
                                            <span>{{subtotal}}</span>
                                        </div>
                                        <div style="display: flex; justify-content: space-between; margin: 8px 0;">
                                            <span>Descuento:</span>
                                            <span>{{descuento}}</span>
                                        </div>
                                        <div style="display: flex; justify-content: space-between; margin: 8px 0;">
                                            <span>IVA (16%):</span>
                                            <span>{{iva}}</span>
                                        </div>
                                        <div style="display: flex; justify-content: space-between; margin: 8px 0; font-weight: bold; border-top: 1px solid #ddd; padding-top: 8px;">
                                            <span>TOTAL:</span>
                                            <span>{{total}}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Pie de Página -->
                            <div style="border-top: 2px solid #3b82f6; padding-top: 20px; text-align: center; color: #666;">
                                <p>¡Gracias por su preferencia!</p>
                                <p>{{empresa_nombre}} - {{empresa_rif}}</p>
                                <p>Tel: {{empresa_telefono}} - {{empresa_direccion}}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Sistema de arrastrar variables
        document.querySelectorAll('.variable-item').forEach(item => {
            item.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('text/plain', e.target.dataset.variable);
            });
        });

        // Permitir soltar variables en el editor
        const editor = document.getElementById('editorArea');
        editor.addEventListener('dragover', (e) => {
            e.preventDefault();
        });

        editor.addEventListener('drop', (e) => {
            e.preventDefault();
            const variable = e.dataTransfer.getData('text/plain');
            document.execCommand('insertText', false, variable);
        });

        // Toolbar commands
        document.querySelectorAll('[data-command]').forEach(btn => {
            btn.addEventListener('click', () => {
                document.execCommand(btn.dataset.command, false, null);
                editor.focus();
            });
        });

        // Cambios de formato
        document.getElementById('fontFamily').addEventListener('change', function() {
            document.execCommand('fontName', false, this.value);
            editor.focus();
        });

        document.getElementById('fontSize').addEventListener('change', function() {
            document.execCommand('fontSize', false, this.value);
            editor.focus();
        });

        document.getElementById('textAlign').addEventListener('change', function() {
            document.execCommand('justify' + this.value.charAt(0).toUpperCase() + this.value.slice(1));
            editor.focus();
        });

        document.getElementById('textColor').addEventListener('input', function() {
            document.execCommand('foreColor', false, this.value);
            editor.focus();
        });

        // Cambiar plantillas
        document.querySelectorAll('.template-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.template-btn').forEach(b => b.classList.remove('template-active'));
                this.classList.add('template-active');
                // Aquí cargarías la plantilla seleccionada
                alert('Cargando plantilla: ' + this.dataset.template);
            });
        });

        // Guardar plantilla
        document.getElementById('btnSave').addEventListener('click', function() {
            const content = editor.innerHTML;
            localStorage.setItem('plantilla_factura', content);
            alert('✅ Plantilla guardada correctamente');
        });

        // Vista previa
        document.getElementById('btnPreview').addEventListener('click', function() {
            const content = editor.innerHTML;
            const previewWindow = window.open('', '_blank');
            previewWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Vista Previa - Plantilla</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                    </style>
                </head>
                <body>
                    ${content}
                </body>
                </html>
            `);
        });

        // Cargar plantilla guardada
        window.addEventListener('DOMContentLoaded', () => {
            const saved = localStorage.getItem('plantilla_factura');
            if (saved) {
                editor.innerHTML = saved;
            }
        });
    </script>
</body>
</html>